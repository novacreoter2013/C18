<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>

<style>
body{
  background:#05070f;
  color:white;
  font-family:Arial;
  padding:30px;
}
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:30px;
}
button{
  background:#a855f7;
  border:none;
  padding:8px 16px;
  color:white;
  cursor:pointer;
  border-radius:6px;
}
.card{
  background:#0b1020;
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
}
small{
  color:#9ca3af;
}
</style>
</head>

<body>

<div class="top">
  <h2>ðŸ“© Contact Messages</h2>
  <button onclick="logout()">Logout</button>
</div>

<div id="messages"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signOut, onAuthStateChanged } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBhIXkDDzGXZOi9rWQpSZTin1PJ3L0ssfg",
  authDomain: "darshil-portfolio-db1a7.firebaseapp.com",
  databaseURL: "https://darshil-portfolio-db1a7-default-rtdb.firebaseio.com",
  projectId: "darshil-portfolio-db1a7",
  storageBucket: "darshil-portfolio-db1a7.firebasestorage.app",
  messagingSenderId: "523758649610",
  appId: "1:523758649610:web:4a7c9698501c8128433af3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

/* PROTECT PAGE */
onAuthStateChanged(auth, user=>{
  if(!user){
    window.location.href = "./firbase.htm";
  }
});

/* LOAD MESSAGES */
fetch("https://darshil-portfolio-db1a7-default-rtdb.firebaseio.com/messages.json")
  .then(res=>res.json())
  .then(data=>{
    const box = document.getElementById("messages");
    box.innerHTML = "";

    if(!data){
      box.innerHTML = "<p>No messages found</p>";
      return;
    }

    Object.values(data).reverse().forEach(msg=>{
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <h3>${msg.name}</h3>
        <p><strong>Email:</strong> ${msg.email}</p>
        <p>${msg.message}</p>
        <small>${msg.time}</small>
      `;
      box.appendChild(div);
    });
  });

/* LOGOUT */
window.logout = function(){
  signOut(auth).then(()=>{
    window.location.href = "./firbase.htm";
  });
};
</script>

</body>
</html>
